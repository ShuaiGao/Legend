<html>
<head>
<link rel="stylesheet" type="text/css" href="Snake.css">
<title>Snake</title>

</head>


<!--body  onkeyup="whichKeyPressed(event)" background="#8d02ee">
        <audio loop="loop" id="Background-AudioPlayer" preload="auto">
        <source src="audio/background.mp3" type="audio/mp3"/>
        </audio>
        <audio id="GameOver-AudioPlayer" preload="auto">
        <source src="audio/gameover.ogg" type="audio/ogg">
        </audio>
        <audio id="Score-AudioPlayer" preload="auto">
        <source src="audio/score.mp3" type="audio/mp3"/>
        </audio>
        <h1>Snake</h1>
        <hr/>
        <canvas id="Snake-Canvas"></canvas>
        <hr/>
        <p>当前用时：<span id="Snake-Time"></span>    当前得分：<span id="Snake-Score"></span>   蛇长：<span id="Snake-Length"></span></p>
        <p id="Snake-Status"></p>
        <script src="Snake.js">
        </script>
-->
<body onkeyup="whichKeyPressed(event)">
<canvas id="myCanvas" width="1000" height="1000" style="border:1px solid #c3c3c3;"></canvas>
<p id="out">hhhhhhhhhhhhhhh</p>
<script src="Snake.js">
</script>
</body>

<!--script type="text/javascript">
        var c=document.getElementById("myCanvas");
        var ctx=c.getContext("2d");
        ctx.lineWidth="2";
        var LEFT = 1;
        var UP = 2;
        var RIGHT = 3;
        var DOWN = 4;
        var BOXSIDE = 45;
        var BOXSTEP = 50;
        var LINEWIDTH = 3;
        var MAXWIDTH = c.width/BOXSTEP;
        var MAXHEIGHT = c.height/BOXSTEP;


        var snake = new Snake();

        // 红色矩形
        CreateMap();
        //snake.init();
        //snake.moveDirection();
        lists = [{'x':2,'y':3},{'x':2,'y':4}]
        paintSomePoint(lists);
        function whichKeyPressed(event){
                myOut(event.keyCode.toString(),event.keyCode.toString());
                if(snake.m_hasChanged ){
                        return null;
                }
                switch (event.keyCode) {
                        case 37://left
                                if (snake.m_nDirect == RIGHT) {
                                        if (snake.freshTime < 500)
                                                snake.freshTime += 40;
                                        break
                                }
                                if (snake.m_nDirect == LEFT)
                                        if (snake.freshTime > 99)
                                                snake.freshTime -= 40;
                                snake.m_nDirect = LEFT;
                                break;
                        case 38://up
                                if (snake.m_nDirect == DOWN) {
                                        if (snake.freshTime < 500)
                                                snake.freshTime += 40;
                                        break
                                }
                                if (snake.m_nDirect == UP)
                                        if (snake.freshTime > 99)
                                                snake.freshTime -= 40;
                                snake.m_nDirect = UP;
                                break;
                        case 39://right
                                if (snake.m_nDirect == LEFT) {
                                        if (snake.freshTime < 500)
                                                snake.freshTime += 40;
                                        break
                                }
                                if (snake.m_nDirect == RIGHT)
                                        if (snake.freshTime > 99)
                                                snake.freshTime -= 40;
                                snake.m_nDirect = RIGHT;
                                break;
                        case 40://down
                                if (snake.m_nDirect == UP) {
                                        if (snake.freshTime < 500)
                                                snake.freshTime += 40;
                                        break
                                }
                                if (snake.m_nDirect == DOWN)
                                        if (snake.freshTime > 99)
                                                snake.freshTime -= 40;
                                snake.m_nDirect = DOWN;
                                break;
                        default :
                                break;

                }
                snake.m_hasChanged = true;
        }
        function Point(x, y) {
                this.x = x;
                this.y = y;
        }

        function Snake(){
                this.m_hasChanged = false;
                this.m_aBody = new Array();
                this.freshTime = 500;
                this.m_pAim = new Point(10,10);
                this.m_body = [1*MAXWIDTH+4, 1*MAXWIDTH+3, 1*MAXWIDTH+2];
                this.m_aBody[0] = new Point(4, 2);
                this.m_aBody[1] = new Point(3, 2);
                this.m_aBody[2] = new Point(2, 2);
                this.m_nDirect=3;// left:1 up:2 right:3  down:4
                this.init = function(){

                        ctx.beginPath();
                        //ctx.lineWidth="2";
                        ctx.strokeStyle = "green";
                        for(i in snake.m_aBody) {
                                ctx.strokeRect(snake.m_aBody[i].x * BOXSTEP, snake.m_aBody[i].y * BOXSTEP, BOXSIDE, BOXSIDE);
                        }
                        ctx.strokeStyle = "rgb(0,255,255)";
                        ctx.rect(snake.m_pAim.x * BOXSTEP, snake.m_pAim.y * BOXSTEP, BOXSIDE, BOXSIDE);
                        ctx.stroke();
                };

                this.moveDirection = function() {
                        x = 0;
                        y = 0;
                        if (this.m_nDirect == UP) {
                                x = snake.m_aBody[0].x;
                                y = snake.m_aBody[0].y - 1;
                        } else if (this.m_nDirect == LEFT) {
                                x = snake.m_aBody[0].x - 1;
                                y = snake.m_aBody[0].y;
                        } else if (this.m_nDirect == DOWN) {
                                x = snake.m_aBody[0].x;
                                y = snake.m_aBody[0].y + 1;
                        } else if (this.m_nDirect == RIGHT) {
                                x = snake.m_aBody[0].x + 1;
                                y = snake.m_aBody[0].y;
                        } else {
                                return null;
                        }
                        if(x == 0 || y == 0 || x == MAXWIDTH-1 || y == MAXHEIGHT - 1){
                                alert("Game Over!");
                                return null;
                        }
                        if(((y - 1) * (MAXWIDTH-2) + x) in this.m_body){
                                alert("Game Over!");
                                return null;
                        }
                        pp ={'x':x, 'y':y};
                        this.m_body.unshift(pp.y*MAXHEIGHT + pp.x);
                        ctx.beginPath();
                        //ctx.lineWidth = "2";
                        //myOut(pp.x.toString(),pp.y.toString());

                        snake.m_aBody.unshift(pp);
                        //if(pp.equals(this.m_pAim)){allert("Get you!");}
                        if (pp.x != this.m_pAim.x || pp.y != this.m_pAim.y) {
                                past = snake.m_aBody.pop();
                                this.m_body.pop();
                                ctx.strokeStyle = "white";
                                ctx.strokeRect(past.x * BOXSTEP, past.y * BOXSTEP, BOXSIDE, BOXSIDE);
                        }else{
                                ctx.clearRect(pp.x * BOXSTEP, pp.y * BOXSTEP, BOXSIDE, BOXSIDE);
                                x = Math.ceil(Math.random() * (MAXWIDTH - 2));
                                y = Math.ceil(Math.random() * (MAXHEIGHT - 2));
                                this.m_pAim.x = x;
                                this.m_pAim.y = y;

                                ctx.strokeStyle = "rgb(0,255,255)";
                                ctx.rect(this.m_pAim.x * BOXSTEP, this.m_pAim.y * BOXSTEP, BOXSIDE, BOXSIDE);

                        }
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.strokeStyle = "green";
                        ctx.strokeRect(pp.x*BOXSTEP, pp.y*BOXSTEP, BOXSIDE, BOXSIDE);
                        ctx.stroke();
                        snake.m_hasChanged = false;
                        setTimeout("snake.moveDirection();", this.freshTime);
                }
        }

        function SquareGrid(myarray,width,height) {
                var r = inherit(range.methods);
                r.width = width;
                r.height = height;
                r.walls = new array();
                range.methods = {
                        in_bounds:function(p){
                                return 0 <= p._x < this.width || 0 <= p._y < this.height;
                        },
                        passable:function(self, id) {
                                return id in this.walls;
                        },

                        neighbors:function(id) {
                                x = id._x;
                                y = id._y;
                                results = [(x + 1, y), (x, y - 1), (x - 1, y), (x, y + 1)]
                                if ((x + y) % 2 == 0) {
                                        results.reverse();
                                        results = filter(self.in_bounds, results);
                                        results = filter(self.passable, results);
                                        return results;
                                }
                        }
                };
        }

        function CreateMap() {
                ctx.beginPath();
                //ctx.lineWidth="2";
                ctx.strokeStyle = "rgba(255,0,0,1)";
                for( i = 0; i < c.width; i+=BOXSTEP){
                        ctx.rect(i,0,BOXSIDE,BOXSIDE);
                        ctx.rect(i,c.height-BOXSTEP,BOXSIDE,BOXSIDE);
                }
                for( j = 0; j < c.height; j+=BOXSTEP){
                        ctx.rect(0,j,BOXSIDE,BOXSIDE);
                        ctx.rect(c.width-BOXSTEP,j,BOXSIDE,BOXSIDE);
                }
                ctx.stroke();

                ctx.beginPath();
                //ctx.lineWidth="3";
                ctx.strokeStyle = "rgba(255,255,255,1)";
                for(i=1; i < c.width/BOXSTEP-1; i++)
                        for(j = 1; j < c.height/BOXSTEP-1; j++) {
                                ctx.rect(i*BOXSTEP,j*BOXSTEP,BOXSIDE,BOXSIDE);
                        }
                ctx.stroke();

        }


        function paintSomePoint(myArray){
                for( i in myArray){
                        pp = myArray[i];
                        ctx.beginPath();
                        ctx.strokeStyle = "black";
                        ctx.rect(pp.x*BOXSTEP,pp.y*BOXSTEP,BOXSIDE,BOXSIDE);
                        ctx.stroke();
                }
        }


        function myOut(str1,str2) {
                var myPrint = document.getElementById("out");
                myPrint.innerHTML="( "+str1+", "+str2 +" )";

        }
</script-->


</html>
